
<?php header('Access-Control-Allow-Origin: *'); ?>
<!DOCTYPE HTML>
<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>




            function getRoster(){
                $.ajax({
                    url: "https://orgtmetrics.herokuapp.com/roster",
                    type: 'GET',
                    dataType: 'JSON',
                    beforeSend: function(){
                        //this will be triggered before sending the ajax request
                        console.log('Sending AJAX Request...');
                    },
                    success: function(response){
                        //this will be triggered when the request successfully gets completed
                        //console.log(response.User);
                        dates = [new Date(2011,1,27), new Date(2012,2,29), new Date(2012,8,1)]
                        end_dates = [new Date(2012,3,1), new Date(2013, 3, 1), new Date(2013, 8, 1)]

                        dataPoints = [];

                        data = [
                            {
                                type: "line",
                                dataPoints: dataPoints,
                                showInLegend: true
                            }
                        ];


                        numIIT = 0;
                        var monthHead = new Date()
                        var monthList = []
                        
                        while (numIIT < 3){//var i in response.User) {
                            if (true) {//(response.User[i]['IIT MOU Signed'] != "" && response.User[i]['Grad Date'] != ""){
                                start = dates[numIIT]//new Date(response.User[i]['IIT MOU Signed'])
                                end = end_dates[numIIT]//new Date(response.User[i]['Grad Date'])
                                //console.log(dateDistance(start, monthHead))
                                if (dateDistance(start, monthHead) < 0){
                                    var expands = dateDistance(monthHead, start)
                                    for (var i = 0; i < expands; i++){
                                        monthList.unshift(0)
                                    }
                                    monthHead = start
                                }
                                var startInd = dateDistance(start, monthHead)
                                var endInd = dateDistance(end, monthHead)
                                //console.log(startInd)
                                //console.log(endInd)
                                expands = endInd - monthList.length
                                for (var i = 0; i < expands; i++) {
                                    monthList.push(0)
                                }
                                for (var i = startInd; i <= endInd; i++) {
                                    monthList[i] = monthList[i] + 1
                                }

                            }
                            numIIT++
                        }
                        //console.log(monthList)

                        for (var i = 0; i < monthList.length; i++) {
                            var monthDate = new Date()
                            monthDate.setMonth((monthHead.getMonth() + i) % 12)
                            monthDate.setYear((monthHead.getFullYear())+ (i/12))
                            dataPoints.push({x: monthDate, y: monthList[i]})
                        }


                        var chart = new CanvasJS.Chart("chartContainer", {
                            animationEnabled: true,
                            theme: "light2",
                            title:{
                                text: "Simple Line Chart"
                            },
                            axisY:{
                                includeZero: false
                            },
                            data: data
                        });



                        chart.render();
                    },
                    error: function(){
                        //this will be triggered when the request fails
                        console.log('Request Failed.');
                    }
                });
            }


            function dateDistance(date1, date2){
                var yearDif = date1.getFullYear() - date2.getFullYear()
                var monthDif = date1.getMonth() - date2.getMonth()
                return yearDif * 12 + monthDif
            }

            window.onload = function() {

                getRoster();
            };






        </script>

        <!--<script>
            window.onload = function () {

                data =  [{
                        type: "line",
                        dataPoints: [
                            { y: 450 },
                            { y: 414},
                            { y: 520, indexLabel: "highest",markerColor: "red", markerType: "triangle" },
                            { y: 460 },
                            { y: 450 },
                            { y: 500 },
                            { y: 480 },
                            { y: 480 },
                            { y: 410 , indexLabel: "lowest",markerColor: "DarkSlateGrey", markerType: "cross" },
                            { y: 500 },
                            { y: 480 },
                            { y: 510 }
                        ]},{
                        type: "line",
                        dataPoints:[
                            { y: 10 },
                            { y: 20},
                            { y: 10, indexLabel: "highest",markerColor: "red", markerType: "triangle" },
                            { y: 20 },
                            { y: 30 },
                            { y: 40 },
                            { y: 50 },
                            { y: 60 },
                            { y: 70 , indexLabel: "lowest",markerColor: "DarkSlateGrey", markerType: "cross" },
                            { y: 80 },
                            { y: 90 },
                            { y: 100 }
                        ]}

                    ];

                var chart = new CanvasJS.Chart("chartContainer", {
                	animationEnabled: true,
                	theme: "light2",
                	title:{
                		text: "Simple Line Chart"
                	},
                	axisY:{
                		includeZero: false
                	},
                	data: data
                });
                chart.render();
            }

            function PopulateAll(){
                $.ajax({
                url: "https://orgtmetrics.herokuapp.com/roster",
                type: 'GET',
                dataType: 'JSON',
                beforeSend: function(){
                //this will be triggered before sending the ajax request
                console.log('Sending AJAX Request...');
                },
                success: function(response){
                //this will be triggered when the request successfully gets completed
                console.log(response);
                },
                error: function(){
                //this will be triggered when the request fails
                console.log('Request Failed.');
                }
                });
            }

            PopulateAll();
        -->




        </script>
    </head>
    <body>
        <div id="chartContainer" style="height: 300px; width: 100%;"></div>
        <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    </body>
</html>
